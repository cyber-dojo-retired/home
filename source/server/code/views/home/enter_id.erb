<script>
'use strict';
$(() => {

  const inputId = $('input#id');
  const waitSpinner = $('#wait-spinner');

  const inputIdHandler = () => {
    const id = inputId.val();
    inputId.removeClass('invalid');
    if (id.length > 6) {
      inputId.addClass('invalid');
    }
    else if (id.length === 6) {
      inputId.prop('disabled', true);

      waitSpinner.fadeIn('slow', () => {
        //$.getJSON('/home/xxxx', { id:id }, idHandler)
        // .always(() => {
           waitSpinner.fadeOut('slow');
           inputId.prop('disabled', false);
         //});
      });
    }
  };

  const idHandler = (response) => {
    //...
  };

  cd.onlyBase58 = (element) => {
    // Only accept base58 input.
    // Also accepts a Ctrl-V paste event which
    // will allow any chars to be entered.
    element.keypress((e) => {
      const str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
      if (e.which == 0 || e.charCode == 0) { // special key
        return true;
      }
      else if (str.match(/IOio/)) {
        return false
      }
      else if (str.match(/[a-zA-Z0-9]/)) {
        return true;
      }
      else {
        e.preventDefault();
        return false;
      }
    });
  };

  cd.onlyBase58(inputId);
  inputId.keyup(() => inputIdHandler())
         .focus();

  inputIdHandler();

});
</script>

<div class="enter-id">
  <div class="blurb">
    to access any group or individual exercise
    enter its six character ID
  </div>
  <input type="text"
         id="id"
         value="<%= @id %>">
  </input>
  <img src="/images/rotate-cyber-dojo.gif"
       id="wait-spinner"
       style="display:none;">
</div>
